<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title></title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>{% include JB/setup %}</p>

<p>I&#39;m interested in what insights can be gleaned from real estate prices. Initially I was interested because I wanted to buy a home, and of course (believe it or not this was a surprise to me) there were more nuances than I had anticipated when choosing a location to spend the next $300,000. All of Vermont is beautiful, so at least that was not a consideration. What I do want is:</p>

<ul>
<li>To be close to my current office, and close to potential future employment too.</li>
<li>To be within a 45 minute drive of my extended family. </li>
<li>My kids to have great pre-k through high-school educations.</li>
<li>My wife to be close to her friends (not an issue for me, I&#39;ve got R).</li>
<li>To spend as little as possible on a turn-key home.</li>
</ul>

<p>So that is how I decided I needed some real estate data. In this post I&#39;ll show you how I get the data; hopefully in a future post we&#39;ll do some analysis of it with regards to the above points, plus maybe see what relationships exist between sale values and factors such as school district ratings and maybe even recent political history. </p>

<p>I started with a quick visit to a well-known search bot, which led me to Hadley Wickham&#39;s <code>rvest</code> package (someday I&#39;ll get better at coming up with snappy package names!). There was even a github issue noted about scraping Zillow. Then I saw that the issue resolution was added as a demo in <code>rvest</code>, so most of the heavy lifting was done already! Great! Not a very interesting topic for a post I guess. Well, I&#39;ve started already so lets keep going.</p>

<p>The source for much of the code is here: <a href="https://github.com/notesofdabbler" target="_blank"><a href="https://github.com/notesofdabbler">https://github.com/notesofdabbler</a></a>, and you can see the demo by checking <code>help(package=rvest)</code>. I&#39;ve not tried actually running the demo, but scraping a web page means reading the DOM and parsing the page nodes, the raw HTML, and the CSS for meaning; I assume that Zillow changes the structure of their page somewhat regularly and that the demo script will probably need to be updated to work as intended&ndash;so that&#39;s what I&#39;ll do here. I&#39;m going to follow the others&#39; leads here and adopt the special rvest <code>%&gt;%</code> pipe operator in this script, even though I&#39;m not 100% comfortable using pipes in my bash scripts.</p>

<p>First we need a URL to parse. It&#39;s pretty easy to go to the main page, do a search for Vermont, and copy the resulting URL. I see that only 20 homes are displayed at a time, so I click to page 2, note how the query changes in the URL, and expand on it in my R code.</p>

<pre><code class="r">library(rvest)

url &lt;- &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/&quot;#2_p/&quot;
# I manually checked the source html to find the correct node to read
more.urls &lt;- read_html(url) %&gt;%
  html_nodes(&quot;.zsg-pagination a&quot;) %&gt;%
  html_attr(&quot;href&quot;) 
# See how high the pagination goes
more.urls &lt;- more.urls[!is.na(more.urls)]
more.urls &lt;- strsplit(more.urls, &#39;/&#39;)
more.urls &lt;- lapply(more.urls, function(x) x[length(x)])
more.urls &lt;- as.numeric(gsub(&#39;[_p]&#39;,&#39;&#39;, more.urls))
more.urls &lt;- max(more.urls)
# Now paste together a url for each page
urls &lt;- c(url, paste0(url,2:more.urls,&#39;_p/&#39;))

urls
</code></pre>

<pre><code>##  [1] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/&quot;     
##  [2] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/2_p/&quot; 
##  [3] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/3_p/&quot; 
##  [4] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/4_p/&quot; 
##  [5] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/5_p/&quot; 
##  [6] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/6_p/&quot; 
##  [7] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/7_p/&quot; 
##  [8] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/8_p/&quot; 
##  [9] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/9_p/&quot; 
## [10] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/10_p/&quot;
## [11] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/11_p/&quot;
## [12] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/12_p/&quot;
## [13] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/13_p/&quot;
## [14] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/14_p/&quot;
## [15] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/15_p/&quot;
## [16] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/16_p/&quot;
## [17] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/17_p/&quot;
## [18] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/18_p/&quot;
## [19] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/19_p/&quot;
## [20] &quot;http://www.zillow.com/homes/for_sale/VT/58_rid/any_days/45.537137,-69.062805,42.187829,-75.846863_rect/7_zm/20_p/&quot;
</code></pre>

<p>Next I use a line from the demo script to scrape each of these URLs. Since I&#39;ve now got 20 urls I go ahead and define a quick function to do the scraping. The function is really just an <code>lapply</code> loop.</p>

<pre><code class="r"># The scraper function
getZillow &lt;- function(urls) {
    # return a list of html &lt;article&gt;&lt;/article&gt; tags, one for each URL
    lapply(urls, function(u) {
        # call out the at-bat url in case there is an error
        cat(u, &#39;\n&#39;)
        houses &lt;- read_html(u) %&gt;%
          html_nodes(&quot;article&quot;)
        houses
    })
}
</code></pre>

<p>To use this function I just need to give it the urls I made earlier:</p>

<pre><code class="r">zdata2 &lt;- getZillow(urls)
</code></pre>

<p>The &ldquo;thing&rdquo; about <code>rvest</code> is that the returned values are stored with external pointers, which is a new concept for me. I tried saving the pointers with <code>save()</code> for later analysis but it only saved the pointer, not the value. I didn&#39;t try <code>saveRDS()</code>; instead I decided to parse them right now and save the parsed values for later analysis. To parse an article tag I need to know what&#39;s in it. I can read it by just coercing it to a character vector, copying it off the console into my text editor (I&#39;m a gedit user in Ubuntu), and poring through it in a civilized way. get ready for some ugly:</p>

<pre><code class="r">as.character(zdata[[1]][1])
</code></pre>

<pre><code>&lt;article statustype=&quot;1&quot; latitude=&quot;44485389&quot; id=&quot;zpid_12653346&quot; class=&quot;property-listing zsg-media image-loaded image-controls-on-canvas&quot; longitude=&quot;-73194252&quot;
  &lt;figure class=&quot;photo zsg-image zsg-media-img&quot; data-photourl=&quot;http://photos3.zillowstatic.com/p_g/IS5q7x8wtqnk381000000000.jpg&quot;
    &lt;a href=&quot;/homedetails/271-Hildred-Dr-271-Burlington-VT-05401/12653346_zpid/&quot; class=&quot;routable mask hdp-link&quot;
      &lt;img rel=&quot;nofollow&quot; alt=&quot;271 Hildred Dr # 271, Burlington, VT&quot; src=&quot;http://photos3.zillowstatic.com/p_g/IS5q7x8wtqnk381000000000.jpg&quot; class=&quot;image-loaded&quot;/
      &lt;figcaption class=&quot;zsg-image-badge_black&quot;
12 photos&lt;/figcaption
    &lt;/a
    &lt;div class=&quot;terse-list-card-actions&quot;
      &lt;a href=&quot;/myzillow/UpdateFavorites.htm?zpid=12653346&amp;amp;operation=add&amp;amp;ajax=false&quot; rel=&quot;nofollow&quot; data-fm-zpid=&quot;12653346&quot; data-fm-callback=&quot;windowReloadSuccessHandler&quot; data-after-auth-action-type=&quot;Event&quot; data-after-auth-global-event=&quot;favoriteManager:addFavoriteProperty&quot; data-target-id=&quot;register&quot; title=&quot;Save this home&quot; data-show-home-owner-lightbox=&quot;false&quot; data-za-label=&quot;Save Map:List&quot; data-address=&quot;271 Hildred Dr # 271, Burlington, VT 05401&quot; class=&quot;zsg-lightbox-show open-on-any-click&quot; id=&quot;register_opener_0&quot;
        &lt;span class=&quot;zsg-icon-heart-line&quot;/
        &lt;span class=&quot;image-control sprite-heart-line&quot;/
      &lt;/a
    &lt;/div
  &lt;/figure
  &lt;div class=&quot;property-listing-data&quot;
    &lt;div class=&quot;property-info&quot;
      &lt;strong
        &lt;dt class=&quot;property-address&quot;
          &lt;span itemscope=&quot;&quot; itemtype=&quot;http://schema.org/SingleFamilyResidence&quot;
            &lt;span itemprop=&quot;address&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/PostalAddress&quot;
              &lt;a href=&quot;/homedetails/271-Hildred-Dr-271-Burlington-VT-05401/12653346_zpid/&quot; class=&quot;hdp-link routable&quot; title=&quot;271 Hildred Dr # 271, Burlington, VT Real Estate&quot;
&lt;span itemprop=&quot;streetAddress&quot;
271 Hildred Dr # 271&lt;/span
, &lt;span itemprop=&quot;addressLocality&quot;
Burlington&lt;/span
, &lt;span itemprop=&quot;addressRegion&quot;
VT&lt;/span
&lt;span itemprop=&quot;postalCode&quot; class=&quot;hide&quot;
05401&lt;/span
&lt;/a
            &lt;/span
            &lt;span itemprop=&quot;geo&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/GeoCoordinates&quot;
              &lt;meta itemprop=&quot;latitude&quot; content=&quot;44.485389&quot;/
              &lt;meta itemprop=&quot;longitude&quot; content=&quot;-73.194252&quot;/
            &lt;/span
          &lt;/span
        &lt;/dt
      &lt;/strong
      &lt;dt class=&quot;listing-type zsg-content_collapsed&quot;
&lt;span class=&quot;zsg-icon-for-sale type-icon&quot;/
Condo For Sale&lt;/dt
      &lt;dt class=&quot;price-large zsg-h2 zsg-content_collapsed&quot;
$126,900&lt;/dt
      &lt;dt class=&quot;property-data&quot;
        &lt;span class=&quot;beds-baths-sqft&quot;
1 bd • 1 ba • 688 sqft&lt;/span
        &lt;span class=&quot;built-year&quot;
 • Built 1992&lt;/span
      &lt;/dt
      &lt;dt class=&quot;doz zsg-fineprint&quot;
2 days on Zillow&lt;/dt
    &lt;/div
  &lt;/div
  &lt;div class=&quot;terse-list-card-actions&quot;
    &lt;a href=&quot;/myzillow/UpdateFavorites.htm?zpid=12653346&amp;amp;operation=add&amp;amp;ajax=false&quot; rel=&quot;nofollow&quot; data-fm-zpid=&quot;12653346&quot; data-fm-callback=&quot;windowReloadSuccessHandler&quot; data-after-auth-action-type=&quot;Event&quot; data-after-auth-global-event=&quot;favoriteManager:addFavoriteProperty&quot; data-target-id=&quot;register&quot; title=&quot;Save this home&quot; data-show-home-owner-lightbox=&quot;false&quot; data-za-label=&quot;Save Map:List&quot; data-address=&quot;271 Hildred Dr # 271, Burlington, VT 05401&quot; class=&quot;zsg-lightbox-show open-on-any-click&quot; id=&quot;register_opener_1&quot;
      &lt;span class=&quot;zsg-icon-heart-line&quot;/
      &lt;span class=&quot;image-control sprite-heart-line&quot;/
    &lt;/a
  &lt;/div
  &lt;div class=&quot;minibubble template hide&quot;
    &lt;!--{&quot;bed&quot;:1,&quot;miniBubbleType&quot;:1,&quot;image&quot;:&quot;http://photos3.zillowstatic.com/p_a/IS5q7x8wtqnk381000000000.jpg&quot;,&quot;sqft&quot;:688,&quot;label&quot;:&quot;$127K&quot;,&quot;isPropertyTypeVacantLand&quot;:false,&quot;datasize&quot;:8,&quot;title&quot;:&quot;$127K&quot;,&quot;bath&quot;:1.0}--
  &lt;/div
&lt;/article
</code></pre>

<p>I&#39;ll spare you the trial and error, but I eventually learned there are two types of articles: property data and photo cards. I adapted the demo code into functions to parse each type of article, then I ran them through an intermediary function that would determine which parsing function to call. These functions are pretty ugly so I&#39;ll save them for last. They both required me to read the article, identify the node and attribute to read, shape the results into a data frame, and bind them to the rest of the data.</p>

<p>Here are the functions. They include an argument to debug the script as it runs&ndash;this just means if you set <code>debugFun=cat</code> it will call out each node as it runs, and when it fails you can tease apart the node that caused the crash and get everything working again.  </p>

<p>The actual tables are pretty boring, so I&#39;ll save them for future plotting. I suspect there are more than a few homes listed multiple times, especially with the photo cards, so I&#39;ll have to weed those out later. In any case with these functions you can substitute in your own URLs and check out what the home prices in your area might tell you. Thanks for reading.</p>

<pre><code class="r"># Here&#39;s how I put it all together
zdata3 &lt;- parseSoldZillow(zdata2)
zdata4 &lt;- do.call(rbind.data.frame, zdata3)
# Let numbers be numeric rather than factor
for(i in c(&#39;lat&#39;, &#39;long&#39;, &#39;price&#39;, &#39;pricepersqft&#39;, &#39;beds&#39;,&#39;baths&#39;,&#39;sqft&#39;, &#39;acres&#39;, &#39;yr_built&#39;)) zdata4[i] &lt;- as.numeric(as.character(zdata4[,i]))
write.csv(zdata4, &#39;data/RS_2016May01.csv&#39;, row.names=FALSE)


# Here are the parsers
parseZillow &lt;- function(zhouse.l, debugFun=function(...) NULL) {
    len.h &lt;-1:length(zhouse.l)
    lapply(1:length(zhouse.l), function(x) {
        debugFun(x, &#39;\n&#39;)
        houses &lt;- zhouse.l[[x]]
        propdata &lt;- tryCatch(houses %&gt;% html_node(&quot;.property-data&quot;), error=function(e) NULL)
        if(!is.null(propdata)) {
            parsePropData(houses, debugFun)
        } else {
            parsePhotoCard(houses, debugFun)
        }
    })
}

parsePropData &lt;- function(houses, debugFun) {
    debugFun(x, &#39;\n&#39;)
    z_id &lt;- houses %&gt;% html_attr(&quot;id&quot;)

    debugFun(&#39;    address\n&#39;)
    address &lt;- houses %&gt;%
      html_node(&quot;.property-address a&quot;) %&gt;%
      html_attr(&quot;href&quot;) %&gt;%
      strsplit(&quot;/&quot;) %&gt;%
      pluck(3, character(1))

    debugFun(&#39;    geo\n&#39;)  
    geo &lt;- houses %&gt;%
      html_nodes(&quot;.property-address meta&quot;) %&gt;%
      html_attr(&quot;content&quot;) 
    geo &lt;- as.numeric(geo)
    geo &lt;- data.frame(lat=geo[seq(1,length(geo), by=2)], long=geo[seq(2,length(geo), by=2)])

    debugFun(&#39;    price\n&#39;)  
    price &lt;- houses %&gt;%
      html_node(&quot;.price-large&quot;) %&gt;%
      html_text()

    price &lt;- gsub(&#39;[^0-9]&#39;, &#39;&#39;, price)

    params &lt;- houses %&gt;%
      html_node(&quot;.property-data&quot;) %&gt;%
      html_text() %&gt;%
      strsplit(&quot;, &quot;) 

    params.l &lt;- lapply(params, function(x) {
        if(length(x)) {
            x &lt;- gsub(&#39;Studio&#39;, &#39;0.5 bds&#39;, x)

            debugFun(&#39;    beds\n&#39;)  
            beds &lt;- grepl(&#39;bds&#39;, x)
            if(beds) {
                beds &lt;- x %&gt;%
                strsplit(&#39;bds&#39;)
                beds &lt;- beds[[1]][1]
              } 

            debugFun(&#39;    baths\n&#39;)  
            baths &lt;- grepl(&#39;ba&#39;, x)
            if(baths) {
                baths &lt;- x %&gt;%
                strsplit(&#39;ba&#39;)
                baths &lt;- strsplit(baths[[1]], &#39; &#39;)[[1]]
                baths &lt;- baths[length(baths)]
            } 

            debugFun(&#39;    house_area\n&#39;)  
            house_area &lt;- grepl(&#39;sqft [^a-z]+ &#39;, x)
            if(house_area) {
                house_area &lt;- x %&gt;%
                strsplit(&#39;sqft [^a-z]+ &#39;)
                house_area &lt;- strsplit(house_area[[1]], &#39; &#39;)[[1]]
                house_area &lt;- house_area[length(house_area)]
            } 

            debugFun(&#39;    lot_ac\n&#39;)  
            lot_ac &lt;- grepl(&#39;ac lot&#39;, x)
            if(lot_ac) {
                lot_ac &lt;- x %&gt;%
                strsplit(&#39;ac lot&#39;)
                lot_ac &lt;- strsplit(lot_ac[[1]], &#39; &#39;)[[1]]
                lot_ac &lt;- lot_ac[length(lot_ac)]
            }

            lot_sqft &lt;- grepl(&#39;sqft lot&#39;, x)
            if(lot_sqft) {
                lot_ac &lt;- x %&gt;%
                strsplit(&#39;sqft lot&#39;)
                lot_ac &lt;- gsub(&#39;[^0-9.]&#39;, &#39;&#39;, lot_ac) %&gt;%
                as.numeric() 
                lot_ac &lt;- lot_ac/43560
            }

            debugFun(&#39;    year_built\n&#39;)  
            year_built &lt;- grepl(&#39;Built&#39;, x)
            if(year_built) {
                year_built &lt;- x %&gt;%
                strsplit(&#39;Built&#39;)
                year_built &lt;- year_built[[1]][2]
            } 

            out &lt;- c(beds=beds, baths=baths, sqft=house_area, acres=lot_ac, yr_built=year_built)
            out.vals &lt;- gsub(&#39;[^0-9.]&#39;, &#39;&#39;, out)
            out.df &lt;- data.frame(t(as.numeric(out.vals)))
            names(out.df) &lt;- names(out)
            out.df
        } else data.frame(beds=NA, baths=NA, sqft=NA, acres=NA, yr_built=NA)
    })

    params.df &lt;- do.call(rbind.data.frame, params.l)

    data.frame(z_id=z_id, address=address, geo, price=price, params.df)
}


parsePhotoCard &lt;- function(houses, debugFun) {
    z_id &lt;- houses %&gt;% html_attr(&quot;id&quot;)

    debugFun(&#39;    address\n&#39;)
    address &lt;- houses %&gt;%
      html_node(&quot;.zsg-photo-card-spec a&quot;) %&gt;%
      html_attr(&quot;href&quot;) %&gt;%
      strsplit(&quot;/&quot;) %&gt;%
      pluck(3, character(1))

    debugFun(&#39;    geo\n&#39;)  

    lat &lt;- houses %&gt;% html_attr(&quot;data-latitude&quot;)
    lon &lt;- houses %&gt;% html_attr(&quot;data-longitude&quot;)
#    geo &lt;- houses %&gt;%
#      html_nodes(&quot;.property-address meta&quot;) %&gt;%
#      html_attr(&quot;content&quot;) 

    geo &lt;- data.frame(lat=as.numeric(lat)*10e-7, long=as.numeric(lon)*10e-7)

    debugFun(&#39;    price\n&#39;)  
    price &lt;- houses %&gt;%
      html_nodes(&quot;.zsg-photo-card-status&quot;)%&gt;%
      html_text()

    price &lt;- price!=&#39;Auction&#39;
    for(i in 1:length(price)) {
        if(price[i]) {
            price[i] &lt;- houses[i] %&gt;%
              html_nodes(&quot;.zsg-photo-card-spec&quot;) %&gt;% 
              html_nodes(&quot;.zsg-photo-card-price&quot;) %&gt;%
              html_text()
        }
    }

    price &lt;- gsub(&#39;[^0-9]&#39;, &#39;&#39;, price)

    params &lt;- houses %&gt;%
      html_nodes(&quot;.zsg-photo-card-spec&quot;) %&gt;% 
      html_nodes(&quot;.zsg-photo-card-info&quot;) %&gt;%
      html_text() %&gt;%
      strsplit(&quot;, &quot;)  

    params.l &lt;- lapply(params, function(x) {
        debugFun(x, &#39;\n&#39;)
        if(length(x)) {
            x &lt;- gsub(&#39;Studio&#39;, &#39;0.5 bds&#39;, x)
            x &lt;- gsub(&#39;--&#39;, &#39;NA&#39;, x)
            debugFun(&#39;    beds\n&#39;)  
            beds &lt;- grepl(&#39;bds&#39;, x)
            if(beds) {
                beds &lt;- x %&gt;%
                strsplit(&#39;bds&#39;)
                beds &lt;- beds[[1]][1]
              } 

            debugFun(&#39;    baths\n&#39;)  
            baths &lt;- grepl(&#39;ba&#39;, x)
            if(baths) {
                baths &lt;- x %&gt;%
                strsplit(&#39;ba&#39;)
                baths &lt;- strsplit(baths[[1]], &#39; &#39;)[[1]]
                baths &lt;- baths[length(baths)]
            } 

            debugFun(&#39;    house_area\n&#39;)  
            house_area &lt;- grepl(&#39;sqft&#39;, x)
            if(house_area &amp;&amp; grepl(&#39;k sqft&#39;, x)) {
                house_area &lt;- x %&gt;%
                strsplit(&#39;k sqft&#39;)
                house_area &lt;- strsplit(house_area[[1]], &#39; &#39;)[[1]]
                house_area &lt;- house_area[length(house_area)]
                house_area &lt;- gsub(&#39;[^0-9]&#39;, &#39;&#39;, house_area)
                house_area &lt;- as.numeric(house_area) * 100
            } else {
                house_area &lt;- x %&gt;%
                strsplit(&#39;sqft&#39;)
                house_area &lt;- strsplit(house_area[[1]], &#39; &#39;)[[1]]
                house_area &lt;- house_area[length(house_area)]
            }

            debugFun(&#39;    lot_ac\n&#39;)  
            lot_ac &lt;- grepl(&#39;ac lot&#39;, x)
            if(lot_ac) {
                lot_ac &lt;- x %&gt;%
                strsplit(&#39;ac lot&#39;)
                lot_ac &lt;- strsplit(lot_ac[[1]], &#39; &#39;)[[1]]
                lot_ac &lt;- lot_ac[length(lot_ac)]
            }

            lot_sqft &lt;- grepl(&#39;sqft lot&#39;, x)
            if(lot_sqft) {
                lot_ac &lt;- x %&gt;%
                strsplit(&#39;sqft lot&#39;)
                lot_ac &lt;- gsub(&#39;[^0-9.]&#39;, &#39;&#39;, lot_ac) %&gt;%
                as.numeric() 
                lot_ac &lt;- lot_ac/43560
            }

            debugFun(&#39;    year_built\n&#39;)  
            year_built &lt;- grepl(&#39;Built&#39;, x)
            if(year_built) {
                year_built &lt;- x %&gt;%
                strsplit(&#39;Built&#39;)
                year_built &lt;- year_built[[1]][2]
            } 

            out &lt;- c(beds=beds, baths=baths, sqft=house_area, acres=lot_ac, yr_built=year_built)
            out.vals &lt;- gsub(&#39;[^0-9.]&#39;, &#39;&#39;, out)
            out.df &lt;- data.frame(t(as.numeric(out.vals)))
            names(out.df) &lt;- names(out)
            out.df
        } else data.frame(beds=NA, baths=NA, sqft=NA, acres=NA, yr_built=NA)
    })

    params.df &lt;- do.call(rbind.data.frame, params.l)

    data.frame(z_id=z_id, address=address, geo, price=price, params.df)
}
</code></pre>

</body>

</html>
